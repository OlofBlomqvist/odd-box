import{B as A,e as Z,f as Be,j as t,_ as Y,g as Ke,R as C,r as p,h as Me,i as ae,S as k,c as x,C as P,H as u,L as ne,k as be,l as Le,m as We,n as ze,d as Ve}from"./index-VhmgqZXc.js";import{B as E,S as b,I as w,K as Ye,a as Ue,b as qe,c as Je,d as Ge,e as Qe,f as Xe,g as Ze,P as et}from"./setting_descriptions-C0WjOK5n.js";import{A as tt}from"./args-input-hI3vUIGv.js";const nt={[A.Running]:"Stop site",[A.Stopped]:"Start site",[A.Faulty]:"Start site",[A.Stopping]:"Start site",[A.Starting]:"Stop site",[A.Remote]:"Remote"},ot=({hostedProcess:e,remoteSite:o})=>{var d,n,g,j;const{startSite:a,stopSite:r}=Z(),s=Be(),i=e?(n=(d=s.data)==null?void 0:d.find(v=>v.hostname===e.host_name))==null?void 0:n.state:o?(j=(g=s.data)==null?void 0:g.find(v=>v.hostname===o.host_name))==null?void 0:j.state:A.Remote;return t.jsx(t.Fragment,{children:t.jsxs("div",{style:{fontSize:".8rem",display:"flex",flexDirection:"column",gap:"10px",maxWidth:"750px"},children:[t.jsxs("div",{className:"pb-2 select-none flex items-center justify-between border-b border-gray-500",title:`${i}`,children:[t.jsx("p",{style:{textTransform:"uppercase",fontWeight:"bold"},children:"status:"}),t.jsx("p",{style:{display:"flex",alignItems:"center",gap:"5px"},children:i})]}),t.jsx("div",{style:{marginTop:"10px"},children:i!==A.Remote&&t.jsx(E,{style:{maxWidth:"max-content"},disabled:a.isPending||r.isPending,dangerButton:i===A.Running,onClick:async()=>{e&&(i===A.Running?Y.promise(r.mutateAsync({hostname:e.host_name}),{loading:"Stopping site..",success:"Site stopped!",error:v=>`Failed to stop site: ${v}`}):Y.promise(a.mutateAsync({hostname:e.host_name}),{loading:"Starting site..",success:"Site started!",error:v=>`Failed to start site: ${v}`}))},children:nt[i]})})]})})};var ge={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(e){(function(){var o={}.hasOwnProperty;function a(){for(var i="",d=0;d<arguments.length;d++){var n=arguments[d];n&&(i=s(i,r(n)))}return i}function r(i){if(typeof i=="string"||typeof i=="number")return i;if(typeof i!="object")return"";if(Array.isArray(i))return a.apply(null,i);if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]"))return i.toString();var d="";for(var n in i)o.call(i,n)&&i[n]&&(d=s(d,n));return d}function s(i,d){return d?i?i+" "+d:i+d:i}e.exports?(a.default=a,e.exports=a):window.classNames=a})()})(ge);var at=ge.exports;const W=Ke(at);function rt(e){if(Array.isArray(e)){for(var o=0,a=Array(e.length);o<e.length;o++)a[o]=e[o];return a}else return Array.from(e)}var re=!1;if(typeof window<"u"){var xe={get passive(){re=!0}};window.addEventListener("testPassive",null,xe),window.removeEventListener("testPassive",null,xe)}var ye=typeof window<"u"&&window.navigator&&window.navigator.platform&&(/iP(ad|hone|od)/.test(window.navigator.platform)||window.navigator.platform==="MacIntel"&&window.navigator.maxTouchPoints>1),D=[],G=!1,Se=-1,z=void 0,V=void 0,we=function(o){return D.some(function(a){return!!(a.options.allowTouchMove&&a.options.allowTouchMove(o))})},Q=function(o){var a=o||window.event;return we(a.target)||a.touches.length>1?!0:(a.preventDefault&&a.preventDefault(),!1)},st=function(o){if(V===void 0){var a=!!o&&o.reserveScrollBarGap===!0,r=window.innerWidth-document.documentElement.clientWidth;a&&r>0&&(V=document.body.style.paddingRight,document.body.style.paddingRight=r+"px")}z===void 0&&(z=document.body.style.overflow,document.body.style.overflow="hidden")},lt=function(){V!==void 0&&(document.body.style.paddingRight=V,V=void 0),z!==void 0&&(document.body.style.overflow=z,z=void 0)},it=function(o){return o?o.scrollHeight-o.scrollTop<=o.clientHeight:!1},dt=function(o,a){var r=o.targetTouches[0].clientY-Se;return we(o.target)?!1:a&&a.scrollTop===0&&r>0||it(a)&&r<0?Q(o):(o.stopPropagation(),!0)},ct=function(o,a){if(!o){console.error("disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.");return}if(!D.some(function(s){return s.targetElement===o})){var r={targetElement:o,options:a||{}};D=[].concat(rt(D),[r]),ye?(o.ontouchstart=function(s){s.targetTouches.length===1&&(Se=s.targetTouches[0].clientY)},o.ontouchmove=function(s){s.targetTouches.length===1&&dt(s,o)},G||(document.addEventListener("touchmove",Q,re?{passive:!1}:void 0),G=!0)):st(a)}},ut=function(o){if(!o){console.error("enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.");return}D=D.filter(function(a){return a.targetElement!==o}),ye?(o.ontouchstart=null,o.ontouchmove=null,G&&D.length===0&&(document.removeEventListener("touchmove",Q,re?{passive:!1}:void 0),G=!1)):D.length||lt()};function mt(e=null){let[o,a]=C.useState(e);const{current:r}=C.useRef({current:o});return Object.defineProperty(r,"current",{get:()=>o,set:s=>{Object.is(o,s)||(o=s,a(s))}}),r}function ht(e,o={isStateful:!0}){const a=mt(null),r=p.useRef(null),s=o.isStateful?a:r;return C.useEffect(()=>{!e||(typeof e=="function"?e(s.current):e.current=s.current)}),s}function X(){return X=Object.assign||function(e){for(var o=1;o<arguments.length;o++){var a=arguments[o];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},X.apply(this,arguments)}var ft=function(o){var a=o.classes,r=o.classNames,s=o.styles,i=o.id,d=o.closeIcon,n=o.onClick;return C.createElement("button",{id:i,className:W(a.closeButton,r==null?void 0:r.closeButton),style:s==null?void 0:s.closeButton,onClick:n,"data-testid":"close-button"},d||C.createElement("svg",{className:r==null?void 0:r.closeIcon,style:s==null?void 0:s.closeIcon,width:28,height:28,viewBox:"0 0 36 36","data-testid":"close-icon"},C.createElement("path",{d:"M28.5 9.62L26.38 7.5 18 15.88 9.62 7.5 7.5 9.62 15.88 18 7.5 26.38l2.12 2.12L18 20.12l8.38 8.38 2.12-2.12L20.12 18z"})))},J=typeof window<"u",je=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'];function pt(e){return e.offsetParent===null||getComputedStyle(e).visibility==="hidden"}function vt(e,o){for(var a=0;a<e.length;a++)if(e[a].checked&&e[a].form===o)return e[a]}function xt(e){if(e.tagName!=="INPUT"||e.type!=="radio"||!e.name)return!0;var o=e.form||e.ownerDocument,a=o.querySelectorAll('input[type="radio"][name="'+e.name+'"]'),r=vt(a,e.form);return r===e||r===void 0&&a[0]===e}function _e(e){for(var o=document.activeElement,a=e.querySelectorAll(je.join(",")),r=[],s=0;s<a.length;s++){var i=a[s];(o===i||!i.disabled&&gt(i)>-1&&!pt(i)&&xt(i))&&r.push(i)}return r}function bt(e,o){if(!(!e||e.key!=="Tab")){if(!o||!o.contains)return process,!1;if(!o.contains(e.target))return!1;var a=_e(o),r=a[0],s=a[a.length-1];return e.shiftKey&&e.target===r?(s.focus(),e.preventDefault(),!0):!e.shiftKey&&e.target===s?(r.focus(),e.preventDefault(),!0):!1}}function gt(e){var o=parseInt(e.getAttribute("tabindex"),10);return isNaN(o)?yt(e)?0:e.tabIndex:o}function yt(e){return e.getAttribute("contentEditable")}var St=function(o){var a=o.container,r=o.initialFocusRef,s=p.useRef();return p.useEffect(function(){var i=function(j){a!=null&&a.current&&bt(j,a.current)};if(J&&document.addEventListener("keydown",i),J&&(a!=null&&a.current)){var d=function(){je.findIndex(function(j){var v;return(v=document.activeElement)==null?void 0:v.matches(j)})!==-1&&(s.current=document.activeElement)};if(r)d(),requestAnimationFrame(function(){var g;(g=r.current)==null||g.focus()});else{var n=_e(a.current);n[0]&&(d(),n[0].focus())}}return function(){if(J){var g;document.removeEventListener("keydown",i),(g=s.current)==null||g.focus()}}},[a,r]),null},K=[],oe={add:function(o){K.push(o)},remove:function(o){K=K.filter(function(a){return a!==o})},isTopModal:function(o){return!!K.length&&K[K.length-1]===o}};function wt(e,o){p.useEffect(function(){return o&&oe.add(e),function(){oe.remove(e)}},[o,e])}var jt=function(o,a,r,s,i){var d=p.useRef(null);p.useEffect(function(){return a&&o.current&&s&&(d.current=o.current,ct(o.current,{reserveScrollBarGap:i})),function(){d.current&&(ut(d.current),d.current=null)}},[a,r,o,s,i])},N={root:"react-responsive-modal-root",overlay:"react-responsive-modal-overlay",overlayAnimationIn:"react-responsive-modal-overlay-in",overlayAnimationOut:"react-responsive-modal-overlay-out",modalContainer:"react-responsive-modal-container",modalContainerCenter:"react-responsive-modal-containerCenter",modal:"react-responsive-modal-modal",modalAnimationIn:"react-responsive-modal-modal-in",modalAnimationOut:"react-responsive-modal-modal-out",closeButton:"react-responsive-modal-closeButton"},_t=C.forwardRef(function(e,o){var a,r,s,i,d=e.open,n=e.center,g=e.blockScroll,j=g===void 0?!0:g,v=e.closeOnEsc,I=v===void 0?!0:v,c=e.closeOnOverlayClick,y=c===void 0?!0:c,m=e.container,T=e.showCloseIcon,F=T===void 0?!0:T,$=e.closeIconId,h=e.closeIcon,l=e.focusTrapped,f=l===void 0?!0:l,_=e.initialFocusRef,R=_===void 0?void 0:_,se=e.animationDuration,le=se===void 0?300:se,S=e.classNames,O=e.styles,ie=e.role,Te=ie===void 0?"dialog":ie,Ne=e.ariaDescribedby,Ae=e.ariaLabelledby,ke=e.containerId,Oe=e.modalId,ee=e.onClose,de=e.onEscKeyDown,ce=e.onOverlayClick,ue=e.onAnimationEnd,He=e.children,Ee=e.reserveScrollBarGap,me=ht(o),U=p.useRef(null),B=p.useRef(null),H=p.useRef(null);H.current===null&&J&&(H.current=document.createElement("div"));var he=p.useState(!1),M=he[0],fe=he[1];wt(U,d),jt(U,d,M,j,Ee);var Ie=function(){H.current&&!m&&!document.body.contains(H.current)&&document.body.appendChild(H.current),document.addEventListener("keydown",pe)},Re=function(){H.current&&!m&&document.body.contains(H.current)&&document.body.removeChild(H.current),document.removeEventListener("keydown",pe)},pe=function(q){q.keyCode!==27||!oe.isTopModal(U)||(de==null||de(q),I&&ee())};p.useEffect(function(){return function(){M&&Re()}},[M]),p.useEffect(function(){d&&!M&&(fe(!0),Ie())},[d]);var Pe=function(q){if(B.current===null&&(B.current=!0),!B.current){B.current=null;return}ce==null||ce(q),y&&ee(),B.current=null},te=function(){B.current=!1},De=function(){d||fe(!1),ue==null||ue()},ve=m||H.current,Fe=d?(a=S==null?void 0:S.overlayAnimationIn)!=null?a:N.overlayAnimationIn:(r=S==null?void 0:S.overlayAnimationOut)!=null?r:N.overlayAnimationOut,$e=d?(s=S==null?void 0:S.modalAnimationIn)!=null?s:N.modalAnimationIn:(i=S==null?void 0:S.modalAnimationOut)!=null?i:N.modalAnimationOut;return M&&ve?Me.createPortal(C.createElement("div",{className:W(N.root,S==null?void 0:S.root),style:O==null?void 0:O.root,"data-testid":"root"},C.createElement("div",{className:W(N.overlay,S==null?void 0:S.overlay),"data-testid":"overlay","aria-hidden":!0,style:X({animation:Fe+" "+le+"ms"},O==null?void 0:O.overlay)}),C.createElement("div",{ref:U,id:ke,className:W(N.modalContainer,n&&N.modalContainerCenter,S==null?void 0:S.modalContainer),style:O==null?void 0:O.modalContainer,"data-testid":"modal-container",onClick:Pe},C.createElement("div",{ref:me,className:W(N.modal,S==null?void 0:S.modal),style:X({animation:$e+" "+le+"ms"},O==null?void 0:O.modal),onMouseDown:te,onMouseUp:te,onClick:te,onAnimationEnd:De,id:Oe,role:Te,"aria-modal":"true","aria-labelledby":Ae,"aria-describedby":Ne,"data-testid":"modal",tabIndex:-1},f&&C.createElement(St,{container:me,initialFocusRef:R}),He,F&&C.createElement(ft,{classes:N,classNames:S,styles:O,closeIcon:h,onClick:ee,id:$})))),ve):null});const Ce=({show:e,onClose:o,title:a,subtitle:r,children:s})=>t.jsx(_t,{showCloseIcon:!1,blockScroll:!1,styles:{modal:{background:"transparent",backdropFilter:"blur(20px)",borderRadius:"5px",border:"1px solid #ffffff22"}},open:e,onClose:o,center:!0,children:t.jsxs("div",{children:[a&&t.jsx("h3",{children:a}),r&&t.jsx("p",{style:{fontSize:".9rem"},children:r}),s]})}),Ct=({site:e})=>{var T,F,$,h;const{updateSite:o,deleteSite:a}=Z(),[r,s]=p.useState(e.host_name),[i,d]=p.useState(e.port??8080),[n,g]=p.useState(e.dir??void 0),[j,v]=p.useState(e.bin),[I,c]=p.useState(!1),y=ae(),m=(l,f)=>{let _=Array.isArray(f)||isNaN(f)===!1?f:`${f}`;Y.promise(o.mutateAsync({hostname:e.host_name,siteSettings:{...e,[l]:_}}),{loading:`Updating settings.. [${e.host_name}]`,success:`Settings updated! [${e.host_name}]`,error:R=>`${R}`})};return t.jsxs("div",{style:{paddingBottom:"50px",maxWidth:"750px"},onSubmit:l=>{l.preventDefault()},children:[t.jsxs(k,{noTopSeparator:!0,children:[t.jsx(x,{title:"Hostname",subTitle:b.hostname_frontend,children:t.jsx(w,{originalValue:e.host_name,onSave:l=>{m("host_name",l)},withSaveButton:!0,value:r,onChange:l=>s(l.target.value)})}),t.jsx(x,{title:"Port",subTitle:b.port,children:t.jsx(w,{originalValue:e.port??8080,withSaveButton:!0,onSave:l=>{m("port",l)},value:i,onChange:l=>{isNaN(Number(l.target.value))||d(Number(l.target.value))}})})]}),t.jsxs(k,{noTopSeparator:!0,children:[t.jsx(x,{title:"Directory",subTitle:b.directory,children:t.jsx(w,{value:n,withSaveButton:!0,originalValue:e.dir??void 0,onSave:l=>{m("dir",l)},onChange:l=>g(l.target.value)})}),t.jsx(x,{title:"Bin",subTitle:b.binary,children:t.jsx(w,{value:j,withSaveButton:!0,originalValue:e.bin,onSave:l=>{m("bin",l)},onChange:l=>v(l.target.value)})})]}),t.jsx(k,{noTopSeparator:!0,children:t.jsx(x,{labelFor:"use_https",rowOnly:!0,title:"HTTPS",subTitle:b.https,children:t.jsx(w,{checked:!!e.https,onChange:()=>{m("https",!e.https)},name:"use_https",id:"use_https",type:"checkbox",style:{width:"20px",height:"20px"}})})}),t.jsx(k,{noTopSeparator:!0,children:t.jsx(x,{labelFor:"auto_start",rowOnly:!0,title:"Auto start",subTitle:b.auto_start,children:t.jsx(w,{id:"auto_start",checked:!!e.auto_start,name:"auto_start",onChange:()=>{m("auto_start",!e.auto_start)},type:"checkbox",style:{width:"20px",height:"20px"}})})}),t.jsxs(k,{noTopSeparator:!0,children:[t.jsx(x,{labelFor:"capture_subdomains",rowOnly:!0,title:"Capture sub-domains",subTitle:b.capture_subdomains,children:t.jsx(w,{onChange:()=>{m("capture_subdomains",!e.capture_subdomains)},checked:!!e.capture_subdomains,type:"checkbox",name:"capture_subdomains",id:"capture_subdomains",style:{width:"20px",height:"20px"}})}),t.jsx(x,{rowOnly:!0,labelFor:"disable_tcp_tunnel",title:"Disable TCP tunnel mode",subTitle:b.disable_tcp_tunnel,children:t.jsx(w,{type:"checkbox",checked:!!e.disable_tcp_tunnel_mode,onChange:()=>{m("disable_tcp_tunnel_mode",!e.disable_tcp_tunnel_mode)},id:"disable_tcp_tunnel",name:"disable_tcp_tunnel",style:{width:"20px",height:"20px"}})}),t.jsx(x,{rowOnly:!0,labelFor:"forward_subdomains",title:"Forward sub-domains",subTitle:b.forward_subdomains,children:t.jsx(w,{type:"checkbox",checked:!!e.forward_subdomains,onChange:()=>{m("forward_subdomains",!e.forward_subdomains)},id:"forward_subdomains",name:"forward_subdomains",style:{width:"20px",height:"20px"}})})]}),t.jsxs(k,{noTopSeparator:!0,children:[t.jsx(x,{title:"H2 Hints",subTitle:b.h2_hint}),t.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",justifyContent:"start"},children:[t.jsx(P,{onClick:()=>{var l;m("hints",(l=e.hints)!=null&&l.includes(u.H2)?e.hints.filter(f=>f!==u.H2):[...e.hints??[],u.H2])},checked:!!((T=e==null?void 0:e.hints)!=null&&T.includes(u.H2)),title:"H2"}),t.jsx(P,{onClick:()=>{var l;m("hints",(l=e.hints)!=null&&l.includes(u.H2C)?e.hints.filter(f=>f!==u.H2C):[...e.hints??[],u.H2C])},checked:!!((F=e==null?void 0:e.hints)!=null&&F.includes(u.H2C)),title:"H2C"}),t.jsx(P,{onClick:()=>{var l;m("hints",(l=e.hints)!=null&&l.includes(u.H2CPK)?e.hints.filter(f=>f!==u.H2CPK):[...e.hints??[],u.H2CPK])},checked:!!(($=e==null?void 0:e.hints)!=null&&$.includes(u.H2CPK)),title:"H2CPK"}),t.jsx(P,{onClick:()=>{var l;m("hints",(l=e.hints)!=null&&l.includes(u.NOH2)?e.hints.filter(f=>f!==u.NOH2):[...e.hints??[],u.NOH2])},checked:!!((h=e==null?void 0:e.hints)!=null&&h.includes(u.NOH2)),title:"NOH2"})]}),t.jsx(x,{title:"Log format",subTitle:b.log_format,children:t.jsxs("select",{className:"text-black rounded pl-3 pr-3",value:e.log_format??ne.Standard,onChange:l=>{m("log_format",l.target.value)},name:"log_format",style:{height:"30px",width:"100%"},children:[t.jsx("option",{value:ne.Standard,children:"Standard"}),t.jsx("option",{value:ne.Dotnet,children:"Dotnet"})]})})]}),t.jsx("div",{style:{marginBottom:"20px"},children:t.jsx(x,{labelFor:"exclude_from_start_all",rowOnly:!0,title:"Exclude from 'start all'",subTitle:b.exclude_from_start_all,children:t.jsx(w,{checked:!!e.exclude_from_start_all,onChange:()=>{m("exclude_from_start_all",!e.exclude_from_start_all)},id:"exclude_from_start_all",type:"checkbox",style:{width:"20px",height:"20px"}})})}),t.jsx(x,{title:"Environment variables",subTitle:b.env_vars}),t.jsx(Ye,{onRemoveKey:l=>{var f;m("env_vars",(f=e.env_vars)==null?void 0:f.filter(_=>_.key!==l))},onNewKey:(l,f)=>{var _;m("env_vars",[...((_=e.env_vars)==null?void 0:_.filter(R=>R.key!==l.key&&R.key!==f))??[],{key:l.key,value:l.value}])},keys:e.env_vars??[]}),t.jsx("div",{style:{marginBottom:"20px"}}),t.jsx(x,{title:"Arguments",subTitle:b.args}),t.jsx(tt,{onAddArg:(l,f)=>{var _;m("args",[...((_=e.args)==null?void 0:_.filter(R=>R!==f))??[],l])},onRemoveArg:l=>{var f;m("args",[...((f=e.args)==null?void 0:f.filter(_=>_!==l))??[]])},defaultKeys:e.args??[]}),t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"end",marginTop:"20px"},children:t.jsx(E,{onClick:()=>{c(!0)},style:{width:"max-content"},dangerButton:!0,children:"Delete site"})}),t.jsx(Ce,{show:I,onClose:()=>c(!1),title:"Delete",subtitle:`Are you sure you want to delete the site '${e.host_name}'?`,children:t.jsxs("div",{style:{display:"flex",gap:"20px",marginTop:"10px"},children:[t.jsx(E,{secondary:!0,onClick:()=>c(!1),children:"Cancel"}),t.jsx(E,{onClick:()=>{Y.promise(a.mutateAsync({hostname:e.host_name},{onSuccess:()=>{c(!1),y.navigate({to:"/"})}}),{loading:`Deleting site.. [${e.host_name}]`,success:()=>(y.navigate({to:"/"}),`Site deleted! [${e.host_name}]`),error:l=>`${l}`})},dangerButton:!0,children:"Yes, delete"})]})})]},e.host_name)},Tt=({site:e,show:o,onClose:a,listIndex:r})=>{var m,T,F,$;const{data:s}=be(),{updateRemoteSite:i}=Z(),d=s.find(h=>h.host_name===e.host_name),n=d==null?void 0:d.backends[r],[g,j]=p.useState((n==null?void 0:n.address)??""),[v,I]=p.useState((n==null?void 0:n.port)??8080),c=(n==null?void 0:n.https)??!1,y=({newBackendSettings:h})=>{const l=[...e.backends.slice(0,r),h,...e.backends.slice(r+1)];i.mutateAsync({hostname:e.host_name,siteSettings:{...e,backends:l}})};return n?(console.log("not null, show:",o),t.jsx(Ue,{open:o,onOpenChange:a,children:t.jsxs(qe,{className:"bg-[#242424] border-l-[#ffffff10] w-full",children:[t.jsxs(Je,{className:"text-left",children:[t.jsx(Ge,{className:"text-white",children:"Edit backend"}),t.jsxs(Qe,{children:["Making changes to ",n.address]})]}),t.jsxs(k,{children:[t.jsx(x,{vertical:!0,title:"Address",subTitle:b.hostname_frontend,children:t.jsx(w,{originalValue:n==null?void 0:n.address,onSave:()=>{y({newBackendSettings:{port:n.port,address:g,hints:(n==null?void 0:n.hints)??[],https:c}})},withSaveButton:!0,value:g,onChange:h=>{j(h.target.value)}})}),t.jsx(x,{vertical:!0,title:"Port",subTitle:b.port,children:t.jsx(w,{originalValue:n==null?void 0:n.port,withSaveButton:!0,onSave:()=>{y({newBackendSettings:{port:v,address:n.address,hints:(n==null?void 0:n.hints)??[],https:c}})},value:v,onChange:h=>{isNaN(Number(h.target.value))||I(Number(h.target.value))}})}),t.jsx(x,{labelFor:"use_https",rowOnly:!0,title:"HTTPS",subTitle:b.https,children:t.jsx(w,{checked:c,onChange:()=>{y({newBackendSettings:{port:n.port,address:n.address,hints:(n==null?void 0:n.hints)??[],https:!c}})},name:"use_https",id:"use_https",type:"checkbox",style:{width:"20px",height:"20px"}})}),t.jsxs("div",{children:[t.jsx(x,{title:"Hints",subTitle:b.h2_hint}),t.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",justifyContent:"start",marginTop:"4px"},children:[t.jsx(P,{onClick:()=>{var h;y({newBackendSettings:{port:n.port,address:n.address,hints:(h=n==null?void 0:n.hints)!=null&&h.includes(u.H2)?n==null?void 0:n.hints.filter(l=>l!==u.H2):[...(n==null?void 0:n.hints)??[],u.H2],https:c}})},checked:!!((m=n==null?void 0:n.hints)!=null&&m.includes(u.H2)),title:"H2"}),t.jsx(P,{onClick:()=>{var h;y({newBackendSettings:{port:n.port,address:n.address,hints:(h=n==null?void 0:n.hints)!=null&&h.includes(u.H2C)?n==null?void 0:n.hints.filter(l=>l!==u.H2C):[...(n==null?void 0:n.hints)??[],u.H2C],https:c}})},checked:!!((T=n==null?void 0:n.hints)!=null&&T.includes(u.H2C)),title:"H2C"}),t.jsx(P,{onClick:()=>{var h;y({newBackendSettings:{port:n.port,address:n.address,hints:(h=n==null?void 0:n.hints)!=null&&h.includes(u.H2CPK)?n==null?void 0:n.hints.filter(l=>l!==u.H2CPK):[...(n==null?void 0:n.hints)??[],u.H2CPK],https:c}})},checked:!!((F=n==null?void 0:n.hints)!=null&&F.includes(u.H2CPK)),title:"H2CPK"}),t.jsx(P,{onClick:()=>{var h;y({newBackendSettings:{port:n.port,address:n.address,hints:(h=n==null?void 0:n.hints)!=null&&h.includes(u.NOH2)?n==null?void 0:n.hints.filter(l=>l!==u.NOH2):[...(n==null?void 0:n.hints)??[],u.NOH2],https:c}})},checked:!!(($=n==null?void 0:n.hints)!=null&&$.includes(u.NOH2)),title:"NOH2"})]})]})]}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:".5fr 1fr",gap:"10px",marginTop:"5px"}}),t.jsxs(Xe,{className:"flex flex-row gap-4",children:[t.jsx(E,{onClick:async()=>{try{await i.mutateAsync({hostname:e.host_name,siteSettings:{...e,backends:e.backends.filter((h,l)=>l!==r)}}),a()}catch(h){console.error("delete backend error:",h)}},style:{width:"150px",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:"5px",justifyContent:"center"},dangerButton:!0,children:"Delete"}),t.jsx(Ze,{asChild:!0,children:t.jsx(E,{type:"submit",children:"Close"})})]})]})})):(console.log("null"),null)},Nt=({site:e})=>{var I;const{deleteSite:o,updateRemoteSite:a}=Z(),[r,s]=p.useState(e==null?void 0:e.host_name),[i,d]=p.useState(!1),[n,g]=p.useState({backend:void 0,show:!1,listIndex:-1});p.useEffect(()=>{g(c=>({...c,backends:e.backends}))},[e]);const j=ae(),v=(c,y)=>{let m=Array.isArray(y)||isNaN(y)===!1?y:`${y}`;Y.promise(a.mutateAsync({hostname:e.host_name,siteSettings:{...e,[c]:m}}),{loading:`Updating settings.. [${e.host_name}]`,success:`Settings updated! [${e.host_name}]`,error:T=>`${T}`})};return t.jsxs("div",{style:{paddingBottom:"50px",maxWidth:"750px"},onSubmit:c=>{c.preventDefault()},children:[t.jsx(k,{noTopSeparator:!0,children:t.jsx(x,{title:"Hostname",subTitle:b.hostname_frontend,children:t.jsx(w,{originalValue:e.host_name,onSave:c=>{v("host_name",c)},withSaveButton:!0,value:r,onChange:c=>s(c.target.value)})})}),t.jsxs(k,{noTopSeparator:!0,children:[t.jsx(x,{labelFor:"capture_subdomains",rowOnly:!0,title:"Capture sub-domains",subTitle:b.capture_subdomains,children:t.jsx(w,{onChange:()=>{v("capture_subdomains",!e.capture_subdomains)},checked:!!e.capture_subdomains,type:"checkbox",name:"capture_subdomains",id:"capture_subdomains",style:{width:"20px",height:"20px"}})}),t.jsx(x,{rowOnly:!0,labelFor:"disable_tcp_tunnel",title:"Disable TCP tunnel mode",subTitle:b.disable_tcp_tunnel,children:t.jsx(w,{type:"checkbox",checked:!!e.disable_tcp_tunnel_mode,onChange:()=>{v("disable_tcp_tunnel_mode",!e.disable_tcp_tunnel_mode)},id:"disable_tcp_tunnel",name:"disable_tcp_tunnel",style:{width:"20px",height:"20px"}})}),t.jsx(x,{rowOnly:!0,labelFor:"forward_subdomains",title:"Forward sub-domains",subTitle:b.forward_subdomains,children:t.jsx(w,{type:"checkbox",checked:!!e.forward_subdomains,onChange:()=>{v("forward_subdomains",!e.forward_subdomains)},id:"forward_subdomains",name:"forward_subdomains",style:{width:"20px",height:"20px"}})})]}),t.jsxs(k,{noTopSeparator:!0,children:[t.jsx(x,{title:"Backends",subTitle:b.backends}),t.jsxs("div",{style:{background:"var(--color3)",color:"black",marginTop:"10px",borderRadius:"5px",overflow:"hidden"},children:[(I=e.backends)==null?void 0:I.map((c,y)=>t.jsx("div",{onClick:()=>{g({backend:c,show:!0,listIndex:y})},className:"env-var-item",style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px"},children:t.jsx("p",{style:{zIndex:1,fontSize:".8rem"},children:c.address})},JSON.stringify({backend:c,index:y}))),t.jsx("div",{onClick:()=>{a.mutateAsync({hostname:e.host_name,siteSettings:{...e,backends:[...e.backends,{address:"NEW_BACKEND",port:8080,hints:[],https:!1}]}})},className:"env-var-item",style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px"},children:t.jsxs("div",{style:{zIndex:1,fontSize:".8rem",display:"flex",alignItems:"center",gap:"5px"},children:[t.jsx(et,{}),"New backend"]})})]})]}),t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"end",marginTop:"20px"},children:t.jsx(E,{onClick:()=>{d(!0)},style:{width:"max-content"},dangerButton:!0,children:"Delete site"})}),t.jsx(Ce,{show:i,onClose:()=>d(!1),title:"Delete",subtitle:`Are you sure you want to delete the site '${e.host_name}'?`,children:t.jsxs("div",{style:{display:"flex",gap:"20px",marginTop:"10px"},children:[t.jsx(E,{secondary:!0,onClick:()=>d(!1),children:"Cancel"}),t.jsx(E,{onClick:()=>{o.mutateAsync({hostname:e.host_name},{onSuccess:()=>{d(!1),j.navigate({to:"/"})}})},dangerButton:!0,children:"Yes, delete"})]})},e.host_name),t.jsx(Tt,{listIndex:n.listIndex,site:e,show:n.show,onClose:()=>g(c=>({...c,show:!1}))},JSON.stringify(n.backend))]},e.host_name)},At=({hostedProcess:e,remoteSite:o})=>e?t.jsx(Ct,{site:e}):o?t.jsx(Nt,{site:o}):t.jsx("p",{children:"Site not found"}),kt=({sections:e})=>{const o=ae(),r=new URLSearchParams(window.location.search).get("tab"),[s,i]=p.useState(Number(r)??0);return t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{display:"flex",gap:"20px",marginTop:"20px"},children:e==null?void 0:e.map((d,n)=>t.jsx(Ot,{active:s===n,onClick:()=>{o.navigate({search:{tab:n}}),i(n)},title:d.name},n))}),t.jsx("div",{style:{height:"1px",width:"100%",background:"#ffffff44",marginTop:"-1px",marginBottom:"20px"}}),e==null?void 0:e[s].content]})},Ot=({active:e,title:o,onClick:a})=>t.jsx("div",{style:{color:e?"var(--color2)":"#fff",cursor:"pointer",borderBottom:e?"1px solid var(--color2)":0},onClick:a,children:o}),Ht=()=>{const{data:e}=Le(),{data:o}=be(),a=We({from:"/site/$siteName"}),r=e.find(d=>d.host_name.replaceAll("http://","").replaceAll("https://","")===a.siteName),s=o.find(d=>d.host_name.replaceAll("http://","").replaceAll("https://","")===a.siteName);if(!r&&!s)return t.jsx("p",{children:"site not found"});const i=[];return r&&i.push({name:"Overview",content:t.jsx(ot,{hostedProcess:r,remoteSite:s})}),i.push({name:"Settings",content:t.jsx(At,{hostedProcess:r,remoteSite:s})}),r&&i.push({name:"Log",content:t.jsx(ze,{hostedProcess:r,remoteSite:s})}),t.jsxs("div",{children:[t.jsx("p",{style:{textTransform:"uppercase",fontSize:".9rem",fontWeight:"bold",color:"var(--color2)"},children:a.siteName}),t.jsx(kt,{sections:i},(r==null?void 0:r.host_name)??(s==null?void 0:s.host_name))]})},Pt=Ve("/site/$siteName")({component:Ht});export{Pt as Route};
