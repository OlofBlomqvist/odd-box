import{B as w,e as F,f as W,j as e,_ as D,r as j,g as $,S as v,c as d,C as H,H as a,L as R,h as I,i as E,k as V,l as z,d as B}from"./index-B6VXrZlL.js";import{B as C,S as u,I as f,K as L,O as K,P as M}from"./setting_descriptions-BY7o_I-X.js";import{A as J}from"./args-input-ae8qY1Lu.js";const U={[w.Running]:"Stop site",[w.Stopped]:"Start site",[w.Faulty]:"Start site",[w.Stopping]:"Start site",[w.Starting]:"Stop site",[w.Remote]:"Remote"},Y=({hostedProcess:t,remoteSite:b})=>{var m,s,y,T;const{startSite:x,stopSite:i}=F(),h=W(),p=t?(s=(m=h.data)==null?void 0:m.find(_=>_.hostname===t.host_name))==null?void 0:s.state:b?(T=(y=h.data)==null?void 0:y.find(_=>_.hostname===b.host_name))==null?void 0:T.state:w.Remote;return e.jsx(e.Fragment,{children:e.jsxs("div",{style:{fontSize:".8rem",display:"flex",flexDirection:"column",gap:"10px",maxWidth:"750px"},children:[e.jsxs("div",{className:"pb-2 select-none flex items-center justify-between border-b border-gray-500",title:`${p}`,children:[e.jsx("p",{style:{textTransform:"uppercase",fontWeight:"bold"},children:"status:"}),e.jsx("p",{style:{display:"flex",alignItems:"center",gap:"5px"},children:p})]}),e.jsx("div",{style:{marginTop:"10px"},children:p!==w.Remote&&e.jsx(C,{style:{maxWidth:"max-content"},disabled:x.isPending||i.isPending,dangerButton:p===w.Running,onClick:async()=>{t&&(p===w.Running?D.promise(i.mutateAsync({hostname:t.host_name}),{loading:"Stopping site..",success:"Site stopped!",error:_=>`Failed to stop site: ${_}`}):D.promise(x.mutateAsync({hostname:t.host_name}),{loading:"Starting site..",success:"Site started!",error:_=>`Failed to start site: ${_}`}))},children:U[p]})})]})})},q=({site:t})=>{var N,P,O,r;const{updateSite:b,deleteSite:x}=F(),[i,h]=j.useState(t.host_name),[p,m]=j.useState(t.port??8080),[s,y]=j.useState(t.dir??void 0),[T,_]=j.useState(t.bin),[k,o]=j.useState(!1),g=$(),l=(n,c)=>{let S=Array.isArray(c)||isNaN(c)===!1?c:`${c}`;D.promise(b.mutateAsync({hostname:t.host_name,siteSettings:{...t,[n]:S}}),{loading:`Updating settings.. [${t.host_name}]`,success:`Settings updated! [${t.host_name}]`,error:A=>`${A}`})};return e.jsxs("div",{style:{paddingBottom:"50px",maxWidth:"750px"},onSubmit:n=>{n.preventDefault()},children:[e.jsxs(v,{noTopSeparator:!0,children:[e.jsx(d,{title:"Hostname",subTitle:u.hostname_frontend,children:e.jsx(f,{originalValue:t.host_name,onSave:n=>{l("host_name",n)},withSaveButton:!0,value:i,onChange:n=>h(n.target.value)})}),e.jsx(d,{title:"Port",subTitle:u.port,children:e.jsx(f,{originalValue:t.port??8080,withSaveButton:!0,onSave:n=>{l("port",n)},value:p,onChange:n=>{isNaN(Number(n.target.value))||m(Number(n.target.value))}})})]}),e.jsxs(v,{noTopSeparator:!0,children:[e.jsx(d,{title:"Directory",subTitle:u.directory,children:e.jsx(f,{value:s,withSaveButton:!0,originalValue:t.dir??void 0,onSave:n=>{l("dir",n)},onChange:n=>y(n.target.value)})}),e.jsx(d,{title:"Bin",subTitle:u.binary,children:e.jsx(f,{value:T,withSaveButton:!0,originalValue:t.bin,onSave:n=>{l("bin",n)},onChange:n=>_(n.target.value)})})]}),e.jsx(v,{noTopSeparator:!0,children:e.jsx(d,{labelFor:"use_https",rowOnly:!0,title:"HTTPS",subTitle:u.https,children:e.jsx(f,{checked:!!t.https,onChange:()=>{l("https",!t.https)},name:"use_https",id:"use_https",type:"checkbox",style:{width:"20px",height:"20px"}})})}),e.jsx(v,{noTopSeparator:!0,children:e.jsx(d,{labelFor:"auto_start",rowOnly:!0,title:"Auto start",subTitle:u.auto_start,children:e.jsx(f,{id:"auto_start",checked:!!t.auto_start,name:"auto_start",onChange:()=>{l("auto_start",!t.auto_start)},type:"checkbox",style:{width:"20px",height:"20px"}})})}),e.jsxs(v,{noTopSeparator:!0,children:[e.jsx(d,{labelFor:"capture_subdomains",rowOnly:!0,title:"Capture sub-domains",subTitle:u.capture_subdomains,children:e.jsx(f,{onChange:()=>{l("capture_subdomains",!t.capture_subdomains)},checked:!!t.capture_subdomains,type:"checkbox",name:"capture_subdomains",id:"capture_subdomains",style:{width:"20px",height:"20px"}})}),e.jsx(d,{rowOnly:!0,labelFor:"disable_tcp_tunnel",title:"Disable TCP tunnel mode",subTitle:u.disable_tcp_tunnel,children:e.jsx(f,{type:"checkbox",checked:!!t.disable_tcp_tunnel_mode,onChange:()=>{l("disable_tcp_tunnel_mode",!t.disable_tcp_tunnel_mode)},id:"disable_tcp_tunnel",name:"disable_tcp_tunnel",style:{width:"20px",height:"20px"}})}),e.jsx(d,{rowOnly:!0,labelFor:"forward_subdomains",title:"Forward sub-domains",subTitle:u.forward_subdomains,children:e.jsx(f,{type:"checkbox",checked:!!t.forward_subdomains,onChange:()=>{l("forward_subdomains",!t.forward_subdomains)},id:"forward_subdomains",name:"forward_subdomains",style:{width:"20px",height:"20px"}})})]}),e.jsxs(v,{noTopSeparator:!0,children:[e.jsx(d,{title:"H2 Hints",subTitle:u.h2_hint}),e.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",justifyContent:"start"},children:[e.jsx(H,{onClick:()=>{var n;l("hints",(n=t.hints)!=null&&n.includes(a.H2)?t.hints.filter(c=>c!==a.H2):[...t.hints??[],a.H2])},checked:!!((N=t==null?void 0:t.hints)!=null&&N.includes(a.H2)),title:"H2"}),e.jsx(H,{onClick:()=>{var n;l("hints",(n=t.hints)!=null&&n.includes(a.H2C)?t.hints.filter(c=>c!==a.H2C):[...t.hints??[],a.H2C])},checked:!!((P=t==null?void 0:t.hints)!=null&&P.includes(a.H2C)),title:"H2C"}),e.jsx(H,{onClick:()=>{var n;l("hints",(n=t.hints)!=null&&n.includes(a.H2CPK)?t.hints.filter(c=>c!==a.H2CPK):[...t.hints??[],a.H2CPK])},checked:!!((O=t==null?void 0:t.hints)!=null&&O.includes(a.H2CPK)),title:"H2CPK"}),e.jsx(H,{onClick:()=>{var n;l("hints",(n=t.hints)!=null&&n.includes(a.NOH2)?t.hints.filter(c=>c!==a.NOH2):[...t.hints??[],a.NOH2])},checked:!!((r=t==null?void 0:t.hints)!=null&&r.includes(a.NOH2)),title:"NOH2"})]}),e.jsx(d,{title:"Log format",subTitle:u.log_format,children:e.jsxs("select",{className:"text-black rounded pl-3 pr-3",value:t.log_format??R.Standard,onChange:n=>{l("log_format",n.target.value)},name:"log_format",style:{height:"30px",width:"100%"},children:[e.jsx("option",{value:R.Standard,children:"Standard"}),e.jsx("option",{value:R.Dotnet,children:"Dotnet"})]})})]}),e.jsx("div",{style:{marginBottom:"20px"},children:e.jsx(d,{labelFor:"exclude_from_start_all",rowOnly:!0,title:"Exclude from 'start all'",subTitle:u.exclude_from_start_all,children:e.jsx(f,{checked:!!t.exclude_from_start_all,onChange:()=>{l("exclude_from_start_all",!t.exclude_from_start_all)},id:"exclude_from_start_all",type:"checkbox",style:{width:"20px",height:"20px"}})})}),e.jsx(d,{title:"Environment variables",subTitle:u.env_vars}),e.jsx(L,{onRemoveKey:n=>{var c;l("env_vars",(c=t.env_vars)==null?void 0:c.filter(S=>S.key!==n))},onNewKey:(n,c)=>{var S;l("env_vars",[...((S=t.env_vars)==null?void 0:S.filter(A=>A.key!==n.key&&A.key!==c))??[],{key:n.key,value:n.value}])},keys:t.env_vars??[]}),e.jsx("div",{style:{marginBottom:"20px"}}),e.jsx(d,{title:"Arguments",subTitle:u.args}),e.jsx(J,{onAddArg:(n,c)=>{var S;l("args",[...((S=t.args)==null?void 0:S.filter(A=>A!==c))??[],n])},onRemoveArg:n=>{var c;l("args",[...((c=t.args)==null?void 0:c.filter(S=>S!==n))??[]])},defaultKeys:t.args??[]}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"end",marginTop:"20px"},children:e.jsx(C,{onClick:()=>{o(!0)},style:{width:"max-content"},dangerButton:!0,children:"Delete site"})}),e.jsx(K,{show:k,onClose:()=>o(!1),title:"Delete",subtitle:`Are you sure you want to delete the site '${t.host_name}'?`,children:e.jsxs("div",{style:{display:"flex",gap:"20px",marginTop:"10px"},children:[e.jsx(C,{secondary:!0,onClick:()=>o(!1),children:"Cancel"}),e.jsx(C,{onClick:()=>{D.promise(x.mutateAsync({hostname:t.host_name},{onSuccess:()=>{o(!1),g.navigate({to:"/"})}}),{loading:`Deleting site.. [${t.host_name}]`,success:()=>(g.navigate({to:"/"}),`Site deleted! [${t.host_name}]`),error:n=>`${n}`})},dangerButton:!0,children:"Yes, delete"})]})})]},t.host_name)},G=({site:t,show:b,onClose:x,listIndex:i})=>{var l,N,P,O;const{data:h}=I(),{updateRemoteSite:p}=F(),m=h.find(r=>r.host_name===t.host_name),s=m==null?void 0:m.backends[i],[y,T]=j.useState((s==null?void 0:s.address)??""),[_,k]=j.useState((s==null?void 0:s.port)??8080),o=(s==null?void 0:s.https)??!1,g=({newBackendSettings:r})=>{const n=[...t.backends.slice(0,i),r,...t.backends.slice(i+1)];p.mutateAsync({hostname:t.host_name,siteSettings:{...t,backends:n}})};return s?e.jsxs(K,{show:b,onClose:x,subtitle:s==null?void 0:s.address,title:"Edit backend",children:[e.jsxs(v,{children:[e.jsx(d,{title:"Address",subTitle:u.hostname_frontend,children:e.jsx(f,{originalValue:s==null?void 0:s.address,onSave:()=>{g({newBackendSettings:{port:s.port,address:y,hints:(s==null?void 0:s.hints)??[],https:o}})},withSaveButton:!0,value:y,onChange:r=>{T(r.target.value)}})}),e.jsx(d,{title:"Port",subTitle:u.port,children:e.jsx(f,{originalValue:s==null?void 0:s.port,withSaveButton:!0,onSave:()=>{g({newBackendSettings:{port:_,address:s.address,hints:(s==null?void 0:s.hints)??[],https:o}})},value:_,onChange:r=>{isNaN(Number(r.target.value))||k(Number(r.target.value))}})}),e.jsx(d,{labelFor:"use_https",rowOnly:!0,title:"HTTPS",subTitle:u.https,children:e.jsx(f,{checked:o,onChange:()=>{g({newBackendSettings:{port:s.port,address:s.address,hints:(s==null?void 0:s.hints)??[],https:!o}})},name:"use_https",id:"use_https",type:"checkbox",style:{width:"20px",height:"20px"}})}),e.jsx(d,{title:"Hints",subTitle:u.h2_hint}),e.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",justifyContent:"start"},children:[e.jsx(H,{onClick:()=>{var r;g({newBackendSettings:{port:s.port,address:s.address,hints:(r=s==null?void 0:s.hints)!=null&&r.includes(a.H2)?s==null?void 0:s.hints.filter(n=>n!==a.H2):[...(s==null?void 0:s.hints)??[],a.H2],https:o}})},checked:!!((l=s==null?void 0:s.hints)!=null&&l.includes(a.H2)),title:"H2"}),e.jsx(H,{onClick:()=>{var r;g({newBackendSettings:{port:s.port,address:s.address,hints:(r=s==null?void 0:s.hints)!=null&&r.includes(a.H2C)?s==null?void 0:s.hints.filter(n=>n!==a.H2C):[...(s==null?void 0:s.hints)??[],a.H2C],https:o}})},checked:!!((N=s==null?void 0:s.hints)!=null&&N.includes(a.H2C)),title:"H2C"}),e.jsx(H,{onClick:()=>{var r;g({newBackendSettings:{port:s.port,address:s.address,hints:(r=s==null?void 0:s.hints)!=null&&r.includes(a.H2CPK)?s==null?void 0:s.hints.filter(n=>n!==a.H2CPK):[...(s==null?void 0:s.hints)??[],a.H2CPK],https:o}})},checked:!!((P=s==null?void 0:s.hints)!=null&&P.includes(a.H2CPK)),title:"H2CPK"}),e.jsx(H,{onClick:()=>{var r;g({newBackendSettings:{port:s.port,address:s.address,hints:(r=s==null?void 0:s.hints)!=null&&r.includes(a.NOH2)?s==null?void 0:s.hints.filter(n=>n!==a.NOH2):[...(s==null?void 0:s.hints)??[],a.NOH2],https:o}})},checked:!!((O=s==null?void 0:s.hints)!=null&&O.includes(a.NOH2)),title:"NOH2"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:".5fr 1fr",gap:"10px",marginTop:"5px"},children:[e.jsx(C,{onClick:async()=>{try{await p.mutateAsync({hostname:t.host_name,siteSettings:{...t,backends:t.backends.filter((r,n)=>n!==i)}}),x()}catch(r){console.error("delete backend error:",r)}},style:{},dangerButton:!0,children:"Delete backend"}),e.jsx(C,{style:{},onClick:x,children:"Close"})]})]}):null},Q=({site:t})=>{var k;const{deleteSite:b,updateRemoteSite:x}=F(),[i,h]=j.useState(t==null?void 0:t.host_name),[p,m]=j.useState(!1),[s,y]=j.useState({backend:void 0,show:!1,listIndex:-1});j.useEffect(()=>{y(o=>({...o,backends:t.backends}))},[t]);const T=$(),_=(o,g)=>{let l=Array.isArray(g)||isNaN(g)===!1?g:`${g}`;D.promise(x.mutateAsync({hostname:t.host_name,siteSettings:{...t,[o]:l}}),{loading:`Updating settings.. [${t.host_name}]`,success:`Settings updated! [${t.host_name}]`,error:N=>`${N}`})};return e.jsxs("div",{style:{paddingBottom:"50px",maxWidth:"750px"},onSubmit:o=>{o.preventDefault()},children:[e.jsx(v,{noTopSeparator:!0,children:e.jsx(d,{title:"Hostname",subTitle:u.hostname_frontend,children:e.jsx(f,{originalValue:t.host_name,onSave:o=>{_("host_name",o)},withSaveButton:!0,value:i,onChange:o=>h(o.target.value)})})}),e.jsxs(v,{noTopSeparator:!0,children:[e.jsx(d,{labelFor:"capture_subdomains",rowOnly:!0,title:"Capture sub-domains",subTitle:u.capture_subdomains,children:e.jsx(f,{onChange:()=>{_("capture_subdomains",!t.capture_subdomains)},checked:!!t.capture_subdomains,type:"checkbox",name:"capture_subdomains",id:"capture_subdomains",style:{width:"20px",height:"20px"}})}),e.jsx(d,{rowOnly:!0,labelFor:"disable_tcp_tunnel",title:"Disable TCP tunnel mode",subTitle:u.disable_tcp_tunnel,children:e.jsx(f,{type:"checkbox",checked:!!t.disable_tcp_tunnel_mode,onChange:()=>{_("disable_tcp_tunnel_mode",!t.disable_tcp_tunnel_mode)},id:"disable_tcp_tunnel",name:"disable_tcp_tunnel",style:{width:"20px",height:"20px"}})}),e.jsx(d,{rowOnly:!0,labelFor:"forward_subdomains",title:"Forward sub-domains",subTitle:u.forward_subdomains,children:e.jsx(f,{type:"checkbox",checked:!!t.forward_subdomains,onChange:()=>{_("forward_subdomains",!t.forward_subdomains)},id:"forward_subdomains",name:"forward_subdomains",style:{width:"20px",height:"20px"}})})]}),e.jsxs(v,{noTopSeparator:!0,children:[e.jsx(d,{title:"Backends",subTitle:u.backends}),e.jsxs("div",{style:{background:"var(--color3)",color:"black",marginTop:"10px",borderRadius:"5px",overflow:"hidden"},children:[(k=t.backends)==null?void 0:k.map((o,g)=>e.jsx("div",{onClick:()=>{y({backend:o,show:!0,listIndex:g})},className:"env-var-item",style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px"},children:e.jsx("p",{style:{zIndex:1,fontSize:".8rem"},children:o.address})},JSON.stringify({backend:o,index:g}))),e.jsx("div",{onClick:()=>{x.mutateAsync({hostname:t.host_name,siteSettings:{...t,backends:[...t.backends,{address:"NEW_BACKEND",port:8080,hints:[],https:!1}]}})},className:"env-var-item",style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px"},children:e.jsxs("div",{style:{zIndex:1,fontSize:".8rem",display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx(M,{}),"New backend"]})})]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"end",marginTop:"20px"},children:e.jsx(C,{onClick:()=>{m(!0)},style:{width:"max-content"},dangerButton:!0,children:"Delete site"})}),e.jsx(K,{show:p,onClose:()=>m(!1),title:"Delete",subtitle:`Are you sure you want to delete the site '${t.host_name}'?`,children:e.jsxs("div",{style:{display:"flex",gap:"20px",marginTop:"10px"},children:[e.jsx(C,{secondary:!0,onClick:()=>m(!1),children:"Cancel"}),e.jsx(C,{onClick:()=>{b.mutateAsync({hostname:t.host_name},{onSuccess:()=>{m(!1),T.navigate({to:"/"})}})},dangerButton:!0,children:"Yes, delete"})]})},JSON.stringify(s==null?void 0:s.backend)),e.jsx(G,{listIndex:s.listIndex,site:t,show:s.show,onClose:()=>y(o=>({...o,show:!1}))},JSON.stringify(s.backend))]},t.host_name)},X=({hostedProcess:t,remoteSite:b})=>t?e.jsx(q,{site:t}):b?e.jsx(Q,{site:b}):e.jsx("p",{children:"Site not found"}),Z=({sections:t})=>{const b=$(),i=new URLSearchParams(window.location.search).get("tab"),[h,p]=j.useState(Number(i)??0);return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",gap:"20px",marginTop:"20px"},children:t==null?void 0:t.map((m,s)=>e.jsx(ee,{active:h===s,onClick:()=>{b.navigate({search:{tab:s}}),p(s)},title:m.name},s))}),e.jsx("div",{style:{height:"1px",width:"100%",background:"#ffffff44",marginTop:"-1px",marginBottom:"20px"}}),t==null?void 0:t[h].content]})},ee=({active:t,title:b,onClick:x})=>e.jsx("div",{style:{color:t?"var(--color2)":"#fff",cursor:"pointer",borderBottom:t?"1px solid var(--color2)":0},onClick:x,children:b}),te=()=>{const{data:t}=E(),{data:b}=I(),x=V({from:"/site/$siteName"}),i=t.find(m=>m.host_name.replaceAll("http://","").replaceAll("https://","")===x.siteName),h=b.find(m=>m.host_name.replaceAll("http://","").replaceAll("https://","")===x.siteName);if(!i&&!h)return e.jsx("p",{children:"site not found"});const p=[];return i&&p.push({name:"Overview",content:e.jsx(Y,{hostedProcess:i,remoteSite:h})}),p.push({name:"Settings",content:e.jsx(X,{hostedProcess:i,remoteSite:h})}),i&&p.push({name:"Log",content:e.jsx(z,{hostedProcess:i,remoteSite:h})}),e.jsxs("div",{children:[e.jsx("p",{style:{textTransform:"uppercase",fontSize:".9rem",fontWeight:"bold",color:"var(--color2)"},children:x.siteName}),e.jsx(Z,{sections:p},(i==null?void 0:i.host_name)??(h==null?void 0:h.host_name))]})},oe=B("/site/$siteName")({component:te});export{oe as Route};
